<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="author" content="Edmund Miller"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/css/theme/white.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/npm/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h2 class="author">Edmund Miller</h2><p class="date">Created: 2020-02-04 Tue 20:10</p>
</section>
<section>
<section id="slide-orged16e6f">
<h2 id="orged16e6f">Functional Genomics Documentation</h2>
<ul>
<li><a href="https://functional-genomics.gitlab.io/docs/">https://functional-genomics.gitlab.io/docs/</a></li>

</ul>
</section>
<section id="slide-org9403dff">
<h3 id="org9403dff">Functional Genomics GitLab</h3>
<p>
<a href="https://gitlab.com/functional-genomics">https://gitlab.com/functional-genomics</a>
</p>
</section>
<section id="slide-org01c1dee">
<h3 id="org01c1dee">Goals</h3>
<ul>
<li>Protocols all in one place</li>
<li>Updating protocols quickly</li>
<li>Better on boarding for new lab members</li>
<li>Retaining knowledge when people move on</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgda5a889">
<h2 id="orgda5a889">Open Protocols</h2>
<div class="outline-text-2" id="text-orgda5a889">
</div>
</section>
<section id="slide-org9051458">
<h3 id="org9051458">Highlights</h3>
<ul>
<li>Markdown</li>
<li>Collaboration through Git</li>
<li>Automatic Deployment</li>

</ul>
</section>
<section id="slide-org8428e71">
<h3 id="org8428e71">Markdown</h3>
<div class="outline-text-3" id="text-org8428e71">
</div>
</section>
<section id="slide-org17f8068">
<h4 id="org17f8068">Intro</h4>
<ul>
<li><a href="https://commonmark.org/">https://commonmark.org/</a></li>

</ul>
<div class="org-src-container">

<pre  class="src src-markdown"><span style="color: #ff6c6b; font-weight: bold;"># </span><span style="color: #ff6c6b; font-weight: bold;">Heading 1</span>
<span style="color: #5B6268;">*</span><span style="color: #a9a1e1; font-style: italic;">Italic</span><span style="color: #5B6268;">*</span>
<span style="color: #5B6268;">**</span><span style="color: #da8548; font-weight: bold;">Bold</span><span style="color: #5B6268;">**</span>

<span style="color: #ff6c6b; font-weight: bold;">## </span><span style="color: #ff6c6b; font-weight: bold;">Heading 2</span>
<span style="color: #ff6c6b;">-</span> List
<span style="color: #ff6c6b;">-</span> List
<span style="color: #ff6c6b;">-</span> List

<span style="color: #ff6c6b; font-weight: bold;">### Heading 3</span>
<span style="color: #5B6268;">---</span>

<span style="color: #5B6268; background-color: #2e3138;">```</span><span style="color: #ECBE7B; background-color: #2e3138;">python</span>
<span style="color: #5B6268; background-color: #2e3138;"># </span><span style="color: #5B6268; background-color: #2e3138;">code block</span>
<span style="color: #51afef; background-color: #2e3138;">print</span><span style="background-color: #2e3138;"> </span><span style="color: #98be65; background-color: #2e3138;">'3 backticks or'</span>
<span style="color: #51afef; background-color: #2e3138;">print</span><span style="background-color: #2e3138;"> </span><span style="color: #98be65; background-color: #2e3138;">'indent 4 spaces'</span>
<span style="color: #5B6268; background-color: #2e3138;">```</span>
</pre>
</div>
</section>
<section id="slide-org5b18795">
<h3 id="org5b18795">Collaboration through Git</h3>
<div class="outline-text-3" id="text-org5b18795">
</div>
</section>
<section id="slide-org166355b">
<h4 id="org166355b">Intro to Git</h4>
<ul>
<li><a href="https://happygitwithr.com/">happy git with r</a></li>

<li><a href="https://learnxinyminutes.com/docs/git/">Learn git in y</a></li>
<li><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004668">Plos Computational Biology Paper</a></li>

</ul>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">git</span> clone https://gitlab.com/functional-genomics/docs.git
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Adds all the files in the current directory</span>
<span style="color: #ECBE7B;">git</span> add .
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Creating a commit message</span>
<span style="color: #ECBE7B;">git</span> commit -m <span style="color: #98be65;">"A commit message"</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Pushing to the remote repo</span>
<span style="color: #ECBE7B;">git</span> push origin master
</pre>
</div>
</section>
<section id="slide-orgda473f7">
<h4 id="orgda473f7">Why should you use git?</h4>
<ul>
<li>It’s a super save button that lets you create snapshots/backups of your work.</li>
<li>Lets you work on multiple versions of a project simultaneously – i.e. create a
new step in the pipeline, and change the tool used for alignment in another
and merge them to the main branch when ready</li>
<li>It’s amazing for collaboration and keeps things organized.</li>

</ul>
</section>
<section id="slide-org284bd87">
<h4 id="org284bd87">pre-commit</h4>
<ul>
<li><a href="https://pre-commit.com/">https://pre-commit.com/</a></li>
<li>Runs before <code>git commit</code></li>
<li>Makes everyone follow the rules</li>
<li>Code Formatting(<a href="https://www.shellcheck.net/">shellcheck</a>, <a href="https://github.com/psf/black">black</a>, <a href="https://styler.r-lib.org/">styler</a>)</li>
<li>Commit Formatting</li>

</ul>
</section>
<section id="slide-orga6ad6fc">
<h4 id="orga6ad6fc">Conventional Commits</h4>
<p>
Format:
</p>
<div class="org-src-container">

<pre  class="src src-shell">&lt;type&gt;<span style="color: #51afef;">[</span>optional scope<span style="color: #51afef;">]</span>: &lt;description&gt;

<span style="color: #51afef;">[</span>optional body<span style="color: #51afef;">]</span>

<span style="color: #51afef;">[</span>optional footer<span style="color: #c678dd;">(</span>s<span style="color: #c678dd;">)</span><span style="color: #51afef;">]</span>
</pre>
</div>
<p>
Example:
</p>
<div class="org-src-container">

<pre  class="src src-shell">feat: use poetry instead of conda
</pre>
</div>

<ul>
<li>Changelogs automatically generated</li>
<li><a href="https://semver.org/">https://semver.org/</a></li>

</ul>
</section>
<section id="slide-org0a07776">
<h3 id="org0a07776">CI/CD</h3>
<ul>
<li>Continuous Integration</li>
<li>Continuous Deployment</li>

</ul>
</section>
<section id="slide-orgbfe5b35">
<h4 id="orgbfe5b35">Features</h4>
<ul>
<li>Deploys Website whenever pushed to master</li>
<li>Checks merge requests for correct formatting</li>
<li>Creates PDFs of pages for Web lab use</li>

</ul>
</section>
<section id="slide-orge4856ed">
<h4 id="orge4856ed">GitLab</h4>
<ul>
<li>Password Authetication for Website</li>
<li>CI configured in yaml</li>
<li>Support for GitHub in the future</li>

</ul>
</section>
<section id="slide-org2530085">
<h3 id="org2530085">Create Your Own!</h3>
<div class="org-src-container">

<pre  class="src src-shell">cookiecutter gl:functional-genomics/cookiecutter-open-protocol
</pre>
</div>
</section>
<section id="slide-org9c09c70">
<h4 id="org9c09c70"><span class="todo TODO">TODO</span> Fill in your lab info</h4>
<div class="org-src-container">

<pre  class="src src-shell">
</pre>
</div>
</section>
<section id="slide-org520a242">
<h4 id="org520a242">Workflow</h4>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">make</span> install
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Serving locally http://127.0.0.1:8000/</span>
<span style="color: #ECBE7B;">make</span> serve
</pre>
</div>
</section>
</section>
<section>
<section id="slide-org0eed291">
<h2 id="org0eed291">Nix development</h2>
<div class="outline-text-2" id="text-org0eed291">
</div>
</section>
<section id="slide-org475ae02">
<h3 id="org475ae02">Managing R environments</h3>
<ul>
<li>Reproducible R enviroments</li>
<li><a href="https://nixos.wiki/wiki/R">https://nixos.wiki/wiki/R</a></li>
<li><a href="https://nixos.org/nixos/packages.html?channel=nixpkgs-unstable">https://nixos.org/nixos/packages.html?channel=nixpkgs-unstable</a></li>

</ul>
</section>
<section id="slide-orgf7d0c3d">
<h3 id="orgf7d0c3d">Installing nix</h3>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">curl</span> https://nixos.org/nix/install | sh
</pre>
</div>
</section>
<section id="slide-org2042b97">
<h3 id="org2042b97">nix-shell for R</h3>
<p>
<code>shell.nix</code>
</p>
<div class="org-src-container">

<pre  class="src src-nix"><span style="color: #51afef;">let</span>
  <span style="color: #dcaeea;">pkgs</span> = <span style="color: #c678dd;">import</span> <span style="color: #a9a1e1;">&lt;nixpkgs&gt;</span> { };
  <span style="color: #dcaeea;">stdenv</span> = pkgs.stdenv;
<span style="color: #51afef;">in</span> with pkgs; {
  <span style="color: #dcaeea;">myProject</span> = stdenv.mkDerivation {
    <span style="color: #dcaeea;">name</span> = <span style="color: #98be65;">"bioinformatics-pipeline"</span>;
    <span style="color: #dcaeea;">version</span> = <span style="color: #98be65;">"1"</span>;

    <span style="color: #dcaeea;">buildInputs</span> =
      <span style="color: #5B6268;"># Any package available in CRAN</span>
      [ R rPackages.edgeR rPackages.RColorBrewer tidyverse ];
  };
}
</pre>
</div>
</section>
<section id="slide-org13016da">
<h3 id="org13016da">nix-shell</h3>
<div class="org-src-container">

<pre  class="src src-shell">$ nix-shell
<span style="color: #51afef;">[</span>nix-shell:~/src/fg/presentations/Functional_Genomics/2020-02-05<span style="color: #51afef;">]</span>$ R
&gt;
</pre>
</div>
</section>
</section>
<section>
<section id="slide-org229f246">
<h2 id="org229f246">New and improved Snakemake</h2>
<div class="outline-text-2" id="text-org229f246">
</div>
</section>
<section id="slide-org808f0aa">
<h3 id="org808f0aa">Plain R vs Snakemake example</h3>
<p>
Coming soon!
</p>
</section>
<section id="slide-orgb10a33e">
<h3 id="orgb10a33e">Cookiecutter</h3>
<div class="org-src-container">

<pre  class="src src-shell">cookiecutter gl:functional-genomics/cookiecutter-snakemake-workflow
</pre>
</div>
<ul>
<li>Fill in your info and get started!</li>

</ul>
</section>
<section id="slide-org91b2895">
<h3 id="org91b2895">Before</h3>
<p>
Setup
</p>
<div class="org-src-container">

<pre  class="src src-shell">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
<span style="color: #ECBE7B;">cd</span> project/dir
conda env create -f environment.yml
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Get Coffee while waiting on conda</span>
</pre>
</div>
<p>
Workflow
</p>
<div class="org-src-container">

<pre  class="src src-shell">conda activate smk
<span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
snakemake --use-conda --use-singularity
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Rerunning a specific rule</span>
snakemake --use-conda --use-singularity -R bowtie2
snakemake --report report.html
</pre>
</div>
</section>
<section id="slide-orgd3ac54c">
<h3 id="orgd3ac54c">After</h3>
<p>
Setup
</p>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
<span style="color: #ECBE7B;">make</span> install
<span style="color: #ECBE7B;">make</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Or specific rules</span>
<span style="color: #ECBE7B;">make</span> smk <span style="color: #dcaeea;">rule</span>=bowtie2
<span style="color: #ECBE7B;">make</span> report
</pre>
</div>
</section>
<section id="slide-org18c16e2">
<h3 id="org18c16e2">Cluster</h3>
<div class="outline-text-3" id="text-org18c16e2">
</div>
</section>
<section id="slide-org8a0d9e5">
<h4 id="org8a0d9e5">Before</h4>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">mkdir</span> -p ~/.config/snakemake
<span style="color: #ECBE7B;">cd</span> ~/.config/snakemake
cookiecutter https://github.com/Snakemake-Profiles/slurm.git
<span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
snakemake --profile slurm
</pre>
</div>
</section>
<section id="slide-org137e0f6">
<h4 id="org137e0f6">After</h4>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #ECBE7B;">cd</span> &lt;project/dir&gt;
<span style="color: #ECBE7B;">make</span> profile
<span style="color: #ECBE7B;">make</span> slurm
<span style="color: #ECBE7B;">make</span> slurm <span style="color: #dcaeea;">rule</span>=bowtie2
</pre>
</div>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,

overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'convex', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/npm/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }]

});
</script>
</body>
</html>
